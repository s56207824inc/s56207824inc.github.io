<html>
    <head>
        <title>My Winning Wheel</title>
        <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous"> 
        
        <script src="https://code.jquery.com/jquery-3.3.1.slim.min.js" integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo" crossorigin="anonymous"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js" integrity="sha384-UO2eT0CpHqdSJQ6hJty5KVphtPhzWj9WO1clHTMGa3JDZwrnQq4sF86dIHNDz0W1" crossorigin="anonymous"></script>
        <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js" integrity="sha384-JjSmVgyd0p3pXB1rRibZUAYoIIy6OrQ6VrjIEaFf/nJGzIxFDsf4x0xIM+B07jRM" crossorigin="anonymous"></script>
        <script src="http://cdnjs.cloudflare.com/ajax/libs/gsap/latest/TweenMax.min.js"></script>
        <script src='js\\Winwheel.js'></script>
        <!-- <script src= "https://cdn.jsdelivr.net/npm/vue/dist/vue.js"></script> -->
        <script src="https://cdnjs.cloudflare.com/ajax/libs/vue/2.6.10/vue.min.js"></script>
    </head>

    <body>

        <div id="map"></div>


        <script>
            let pos;
            let map;
            let service;
    
            let Info = [];
            class placeInfo {
                constructor() {
                    this.placeName = "None";
                    this.distanceFrom = 0;
                }
            }


            function initMap() {
                
                bounds = new google.maps.LatLngBounds();
           
                infoWindow = new google.maps.InfoWindow;
                currentInfoWindow = infoWindow;
                if (navigator.geolocation) {
             
                    navigator.geolocation.getCurrentPosition(position => {
                        pos = {
                            lat: position.coords.latitude,
                            lng: position.coords.longitude
                        };
                        map = new google.maps.Map(document.getElementById('map'), {
                            center: pos,
                            zoom: 15
                        });
              
                        getNearbyPlaces(pos);
                    });
                
                            //browser supports geolocation but user has denied permission
                } else {
                    // browser doesn't suppport geolocation
                }
            }
            function getNearbyPlaces(position) {
                let request = {
                    location: position,
                    rankBy: google.maps.places.RankBy.DISTANCE, //依照距離排列
                    keyword: 'restaurant'
                };
                

                service = new google.maps.places.PlacesService(map);
                service.nearbySearch(request, nearbyCallback);
            }
            function nearbyCallback(places, status) {
                let destination = [];
                if (status == google.maps.places.PlacesServiceStatus.OK) {
                    places.forEach(place => {
                        let currLocation = new google.maps.LatLng(place.geometry.location.lat(), 
                                                                  place.geometry.location.lng());
                        let instance = new placeInfo()
                        instance.name = place.name;
                        Info.push(instance);
                        destination.push(currLocation);
                    });
                    calculateDistance(destination);
                }
            }
            function calculateDistance(destination) {
                const serviceForDistance = new google.maps.DistanceMatrixService();
                serviceForDistance.getDistanceMatrix(
                    {
                        origins: [pos],
                        destinations: destination,
                        travelMode: 'DRIVING',
                        unitSystem: google.maps.UnitSystem.METRIC,
                        avoidHighways: true,
                        avoidTolls: true,
                    }, testCallBack);
            }

            function testCallBack(results, status) {
                console.log(results);
                for (let i = 0; i < results.rows[0].elements.length; i++) {
                    Info[i].distanceFrom = results.rows[0].elements[i].distance.value;
                }
                Info.sort(function(a, b) {
                    return a.distanceFrom > b.distanceFrom ? 1 : -1; ///????
                });
                for (let i = 0; i < Info.length; i++) {
                    console.log(Info[i].name);
                    console.log(Info[i].distanceFrom);
                }
            }
        </script>



        <canvas id='myCanvas' 
                width='880' 
                height='300'
                onClick="startSpin();">
            Canvas not supported, use another browser.
        </canvas>

        <script>
            let theWheel = new Winwheel({
                'canvasId'      : 'myCanvas',
                'drawMode'      : 'image',
                'imageOverlay'  : true,
                'numSegments'   : 8,
                'lineWidth'     : 1, 
                'strokeStyle'   : 'black',
                'animation'     : 
                {
                    'type'      : 'spinToStop',
                    'duration'  : 5,
                    'spins'     : 8,
                }
            });

            let pizzaImg = new Image();
            pizzaImg.onload = function()
            {
                theWheel.wheelImage = pizzaImg;
                theWheel.draw();
            }
            pizzaImg.src = 'pizza.png'

            function startSpin()
            {
                // Stop any current animation.
                theWheel.stopAnimation(false);
        
                // Reset the rotation angle to less than or equal to 360 so spinning again works as expected.
                // Setting to modulus (%) 360 keeps the current position.
                theWheel.rotationAngle = theWheel.rotationAngle % 360;
        
                // Start animation.
                theWheel.startAnimation();
            }
        </script>
      
        <script async defer src="https://maps.googleapis.com/maps/api/js?key=AIzaSyAlNRaHqtGB3sTDKymkHmJtYRfPFpfFVsU&libraries=places&callback=initMap"></script>
    </body>
</html>